//  __  __         _          _         ___                        _   
// |  \/  |  __ _ | |_  _ __ (_)__  __ / _ \  _   _   __ _  _ __  | |_ 
// | |\/| | / _` || __|| '__|| |\ \/ /| | | || | | | / _` || '_ \ | __|
// | |  | || (_| || |_ | |   | | >  < | |_| || |_| || (_| || | | || |_ 
// |_|  |_| \__,_| \__||_|   |_|/_/\_\ \__\_\ \__,_| \__,_||_| |_| \__|
// 
// This Pine ScriptÂ® code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// Â© MatrixQuantLabs
//
//@version=6
indicator('Supertrend Pro', shorttitle = 'â˜… Supertrend Proä¸¨è¶…çº§è¶‹åŠ¿ä¸“ä¸šç‰ˆ â˜…', overlay = true)

ShowPrimaryTrend = input.bool(true, 'Show Primary Trendä¸¨æ˜¾ç¤ºä¸»è¶‹åŠ¿', group = 'Supertrendä¸¨è¶…çº§è¶‹åŠ¿', tooltip = 'â–¶ï¸ Primary Trend: Used to identify the overall market direction. It produces smoother lines with fewer trend reversals, offering higher stability at the cost of slower reaction. Ideal for swing or long-term traders, or those looking to filter out short-term noise.\nâ–¶ï¸ ä¸»è¶‹åŠ¿ç”¨äºè¯†åˆ«å¸‚åœºçš„å¤§æ–¹å‘ï¼Œçº¿æ¡å¹³æ»‘ã€è¶‹åŠ¿è½¬å‘ä¸é¢‘ç¹ï¼Œè™½ç„¶ååº”ç•¥æ…¢ä½†ç¨³å®šæ€§å¼ºï¼Œé€‚åˆä¸­é•¿çº¿äº¤æ˜“è€…æˆ–å¸Œæœ›è¿‡æ»¤çŸ­æœŸéœ‡è¡ä¿¡å·çš„ç­–ç•¥ã€‚')
showSecondaryTrend = input.bool(true, 'Show Secondary Trendä¸¨æ˜¾ç¤ºæ¬¡è¶‹åŠ¿', group = 'Supertrendä¸¨è¶…çº§è¶‹åŠ¿', tooltip = 'â–¶ï¸ Secondary Trend: Designed to capture swing opportunities or turning points within a trend. It reacts faster and stays closer to price, but with more frequent changes. Suitable for short-term or swing traders, and often used alongside the primary trend to refine entry and exit timing.\nâ–¶ï¸ æ¬¡è¶‹åŠ¿ç”¨äºæ•æ‰è¶‹åŠ¿ä¸­çš„æ³¢æ®µæœºä¼šæˆ–æ‹ç‚¹ï¼Œçº¿æ¡æ›´è´´è¿‘ä»·æ ¼ã€ååº”è¿…é€Ÿä½†å˜åŒ–è¾ƒé¢‘ç¹ï¼Œé€‚åˆçŸ­çº¿æˆ–æ³¢æ®µäº¤æ˜“è€…ï¼Œå¹¶å¸¸ä¸ä¸»è¶‹åŠ¿æ­é…ç”¨äºåˆ¤æ–­è¿›å‡ºåœºæ—¶æœºã€‚')
ShowFilterLine = input.bool(true, "Show MA Filter Lineä¸¨æ˜¾ç¤º MA è¿‡æ»¤çº¿", group='Supertrendä¸¨è¶…çº§è¶‹åŠ¿', tooltip="â–¶ï¸ Show the MA filter line on the chart for visualizing trend direction.\nâ–¶ï¸ åœ¨å›¾è¡¨ä¸­æ˜¾ç¤ºMAè¿‡æ»¤çº¿ï¼Œä¾¿äºè§‚å¯Ÿè¶‹åŠ¿æ–¹å‘ã€‚")

// è¿‡æ»¤ç”¨çš„å›ºå®šå‡çº¿ï¼šEMA50
MA = ta.ema(close, 50)

// åŠ¨æ€å†³å®šMAé¢œè‰²ï¼šç™½è‰²éœ‡è¡è¿‡æ¸¡ / çº¢è‰²ä¸‹ç©¿ / ç»¿è‰²ä¸Šç©¿
OscillationRange = MA * (0.25  / 100)// å®¹å·®ç™¾åˆ†æ¯”ï¼Œé»˜è®¤0.1%
MAColor = math.abs(close - MA) <= OscillationRange ? color.white : (close > MA ? color.aqua : color.fuchsia)
// ç»˜åˆ¶MAçº¿
plot(ShowFilterLine ? MA : na, color=MAColor, title="MA Filter Lineä¸¨MA è¿‡æ»¤å‡çº¿")

// Supertrend è®¡ç®—
[supertrend1, direction1] = ta.supertrend(3, 12)
[supertrend2, direction2] = ta.supertrend(1.75, 12)
supertrend1 := barstate.isfirst ? na : supertrend1
supertrend2 := barstate.isfirst ? na : supertrend2

// ç»˜å›¾é€»è¾‘
upTrend1 = plot(ShowPrimaryTrend and direction1 < 0 ? supertrend1 : na, 'Primary Bull Lowerä¸¨ä¸»è¶‹åŠ¿çœ‹æ¶¨ä¸‹è½¨', color = color.new(color.green, 0), style = plot.style_linebr)
downTrend1 = plot(ShowPrimaryTrend and direction1 >= 0 ? supertrend1 : na, 'Primary Bear Upperä¸¨ä¸»è¶‹åŠ¿çœ‹è·Œä¸Šè½¨', color = color.new(color.red, 0), style = plot.style_linebr)

upTrend2 = plot(showSecondaryTrend and direction2 < 0 ? supertrend2 : na, 'Secondary Bull Upperä¸¨æ¬¡è¶‹åŠ¿çœ‹æ¶¨ä¸‹è½¨', color = color.new(color.green, 50), style = plot.style_linebr)
downTrend2 = plot(showSecondaryTrend and direction2 >= 0 ? supertrend2 : na, 'Secondary Bear Lowerä¸¨æ¬¡è¶‹åŠ¿çœ‹è·Œä¸‹è½¨', color = color.new(color.red, 50), style = plot.style_linebr)

// ä¸­å¿ƒçº¿ï¼ˆç”¨äºèƒŒæ™¯å¡«å……ï¼‰
bodyMiddle = plot((ShowPrimaryTrend or showSecondaryTrend) and not barstate.isfirst ? (open + close) / 2 : na, 'Body Middle', display = display.none)

// èƒŒæ™¯å¡«å……
fill(bodyMiddle, upTrend1, title = 'PrimaryTrend Bull Fillä¸¨ä¸»è¶‹åŠ¿çœ‹æ¶¨å¡«å……', color = color.new(color.green, 95), fillgaps = false)
fill(bodyMiddle, downTrend1, title = 'PrimaryTrend Bear Fillä¸¨ä¸»è¶‹åŠ¿çœ‹è·Œå¡«å……', color = color.new(color.red, 95), fillgaps = false)
fill(bodyMiddle, upTrend2, title = 'SecondaryTrend Bull Fillä¸¨æ¬¡è¶‹åŠ¿çœ‹æ¶¨å¡«å……', color = color.new(color.green, 95), fillgaps = false)
fill(bodyMiddle, downTrend2, title = 'SecondaryTrend Bear Fillä¸¨æ¬¡è¶‹åŠ¿çœ‹è·Œå¡«å……', color = color.new(color.red, 95), fillgaps = false)

// è¶‹åŠ¿èµ·ç‚¹æ ‡è®°
trend1Start = direction1 != direction1[1]
trend2Start = direction2 != direction2[1]

isBullish1 = ShowPrimaryTrend and trend1Start and direction1 < 0
isBearish1 = ShowPrimaryTrend and trend1Start and direction1 > 0
plotshape(isBullish1 ? supertrend1 : na, location = location.absolute, style = shape.circle, color = color.green, size = size.tiny, title = 'Primary Bull Signalä¸¨ä¸»è¶‹åŠ¿çœ‹æ¶¨ä¿¡å·')
plotshape(isBearish1 ? supertrend1 : na, location = location.absolute, style = shape.circle, color = color.red, size = size.tiny, title = 'Primary Bear Signalä¸¨ä¸»è¶‹åŠ¿çœ‹è·Œä¿¡å·')

isBullish2 = showSecondaryTrend and trend2Start and direction2 < 0
isBearish2 = showSecondaryTrend and trend2Start and direction2 > 0
plotshape(isBullish2 ? supertrend2 : na, location=location.absolute, style=shape.labelup, color=color.green, size=size.tiny, textcolor=color.white, text="å¤š\nLong", title='Long Trading Labelsä¸¨å¤šå¤´äº¤æ˜“ä¿¡å·æ ‡ç­¾')
plotshape(isBearish2 ? supertrend2 : na, location=location.absolute, style=shape.labeldown, color=color.red, size=size.tiny, textcolor=color.white, text="Short\nç©º", title='Short Trading Labelsä¸¨ç©ºå¤´äº¤æ˜“ä¿¡å·æ ‡ç­¾')

// è­¦æŠ¥æ¡ä»¶
alertcondition(ShowPrimaryTrend and direction1[1] > direction1,title = "Primary Trend Bullishä¸¨ä¸»è¶‹åŠ¿çœ‹æ¶¨ ğŸŸ¢",message = "Supertrend Bullish Alertä¸¨è¶…çº§è¶‹åŠ¿çœ‹æ¶¨è­¦æŠ¥ ğŸŸ¢")
alertcondition(ShowPrimaryTrend and direction1[1] < direction1,title = "Primary Trend Bearishä¸¨ä¸»è¶‹åŠ¿çœ‹è·Œ ğŸ”´",message = "Supertrend Bearish Alertä¸¨è¶…çº§è¶‹åŠ¿çœ‹è·Œè­¦æŠ¥ ğŸ”´")
alertcondition(ShowPrimaryTrend and direction1[1] != direction1,title = "Primary Trend Changeä¸¨ä¸»è¶‹åŠ¿å‘ç”Ÿå˜åŒ– ğŸš¨",message = "Supertrend Change Alertä¸¨è¶…çº§è¶‹åŠ¿å˜åŒ–è­¦æŠ¥ ğŸš¨")

alertcondition(showSecondaryTrend and direction2[1] > direction2,title = 'Supertrend Long Signalä¸¨è¶…çº§è¶‹åŠ¿å¤šå¤´äº¤æ˜“ä¿¡å· ğŸŸ¢',message = 'Long Trading Signal Appearsä¸¨å‡ºç°å¤šå¤´äº¤æ˜“ä¿¡å· ğŸŸ¢')
alertcondition(showSecondaryTrend and direction2[1] < direction2,title = 'Supertrend Short Signalä¸¨è¶…çº§è¶‹åŠ¿ç©ºå¤´äº¤æ˜“ä¿¡å· ğŸ”´',message = 'Short Trading Signal Appearsä¸¨å‡ºç°ç©ºå¤´äº¤æ˜“ä¿¡å· ğŸ”´')
alertcondition(showSecondaryTrend and direction2[1] != direction2,title = "Supertrend Short Signalä¸¨è¶…çº§è¶‹åŠ¿äº¤æ˜“ä¿¡å·å˜åŒ–è­¦æŠ¥ ğŸš¨",message = "Trading Signal Change Alertä¸¨äº¤æ˜“ä¿¡å·å˜åŒ–è­¦æŠ¥ ğŸš¨")
